<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>КСУ-02: Исходный файл C:/Repositories/su/505.013.1000_KSU-02/STM32_Main/src/board/stm32f4/system_stm32f4xx.c</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="logo.ico"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">КСУ-02
   
   </div>
   <div id="projectbrief">Станция управления</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Создано системой Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Поиск');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Титульная&#160;страница</span></a></li>
      <li><a href="modules.html"><span>Группы</span></a></li>
      <li><a href="annotated.html"><span>Структуры&#160;данных</span></a></li>
      <li class="current"><a href="files.html"><span>Файлы</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Поиск" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>Файлы</span></a></li>
      <li><a href="globals.html"><span>Список&#160;членов&#160;всех&#160;файлов</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">C:/Repositories/su/505.013.1000_KSU-02/STM32_Main/src/board/stm32f4/system_stm32f4xx.c</div>  </div>
</div>
<div class="contents">
<a href="system__stm32f4xx_8c.html">См. документацию.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;stm32f4xx_hal.h&quot;</span>
<a name="l00067"></a>00067 
<a name="l00084"></a>00084 <span class="comment">/************************* Miscellaneous Configuration ************************/</span>
<a name="l00087"></a>00087 <span class="preprocessor">#if defined(STM32F405xx) || defined(STM32F415xx) || defined(STM32F407xx) || defined(STM32F417xx) || defined(STM32F427xx) || defined(STM32F437xx) || defined(STM32F429xx) || defined(STM32F439xx)</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span><span class="comment">/* #define DATA_IN_ExtSRAM */</span>
<a name="l00089"></a>00089 <span class="preprocessor">#endif </span><span class="comment">/* STM32F405xx || STM32F415xx || STM32F407xx || STM32F417xx || STM32F427xx || STM32F437xx || STM32F429xx || STM32F439xx */</span>
<a name="l00090"></a>00090  
<a name="l00091"></a>00091 <span class="preprocessor">#if defined(STM32F427xx) || defined(STM32F437xx) || defined(STM32F429xx) || defined(STM32F439xx)</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span><span class="comment">/* #define DATA_IN_ExtSDRAM */</span>
<a name="l00093"></a>00093 <span class="preprocessor">#endif </span><span class="comment">/* STM32F427xx || STM32F437xx || STM32F429xx || STM32F439xx */</span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="preprocessor">#if defined(DATA_IN_ExtSRAM) &amp;&amp; defined(DATA_IN_ExtSDRAM)</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span><span class="preprocessor"> #error &quot;Please select DATA_IN_ExtSRAM or DATA_IN_ExtSDRAM &quot; </span>
<a name="l00097"></a>00097 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* DATA_IN_ExtSRAM &amp;&amp; DATA_IN_ExtSDRAM */</span>
<a name="l00098"></a>00098 
<a name="l00101"></a>00101 <span class="comment">/* #define VECT_TAB_SRAM */</span>
<a name="l00102"></a>00102 <span class="comment">//перенести таблицу векторов прерываний по адресу 0х08008000</span>
<a name="l00103"></a><a class="code" href="group___s_t_m32_f4xx___system___private___defines.html#ga40e1495541cbb4acbe3f1819bd87a9fe">00103</a> <span class="preprocessor">#define VECT_TAB_OFFSET  0x8000 </span>
<a name="l00105"></a>00105 <span class="preprocessor"></span><span class="comment">/******************************************************************************/</span>
<a name="l00106"></a>00106 
<a name="l00122"></a>00122   <span class="comment">/* This variable is updated in three ways:</span>
<a name="l00123"></a>00123 <span class="comment">      1) by calling CMSIS function SystemCoreClockUpdate()</span>
<a name="l00124"></a>00124 <span class="comment">      2) by calling HAL API function HAL_RCC_GetHCLKFreq()</span>
<a name="l00125"></a>00125 <span class="comment">      3) each time HAL_RCC_ClockConfig() is called to configure the system clock frequency </span>
<a name="l00126"></a>00126 <span class="comment">         Note: If you use this function to configure the system clock; then there</span>
<a name="l00127"></a>00127 <span class="comment">               is no need to call the 2 first functions listed above, since SystemCoreClock</span>
<a name="l00128"></a>00128 <span class="comment">               variable is updated automatically.</span>
<a name="l00129"></a>00129 <span class="comment">  */</span>
<a name="l00130"></a><a class="code" href="group___s_t_m32_f4xx___system___private___variables.html#gaa3cd3e43291e81e795d642b79b6088e6">00130</a>   uint32_t <a class="code" href="group___s_t_m32_f4xx___system___private___variables.html#gaa3cd3e43291e81e795d642b79b6088e6">SystemCoreClock</a> = 16000000;
<a name="l00131"></a><a class="code" href="group___s_t_m32_f4xx___system___private___variables.html#gacdc3ef54c0704c90e69a8a84fb2d970d">00131</a>   __I uint8_t <a class="code" href="group___s_t_m32_f4xx___system___private___variables.html#gacdc3ef54c0704c90e69a8a84fb2d970d">AHBPrescTable</a>[16] = {0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 6, 7, 8, 9};
<a name="l00132"></a>00132 
<a name="l00141"></a>00141 <span class="preprocessor">#if defined (DATA_IN_ExtSRAM) || defined (DATA_IN_ExtSDRAM)</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>  <span class="keyword">static</span> <span class="keywordtype">void</span> SystemInit_ExtMemCtl(<span class="keywordtype">void</span>); 
<a name="l00143"></a>00143 <span class="preprocessor">#endif </span><span class="comment">/* DATA_IN_ExtSRAM || DATA_IN_ExtSDRAM */</span>
<a name="l00144"></a>00144 
<a name="l00160"></a><a class="code" href="group___s_t_m32_f4xx___system___private___functions.html#ga93f514700ccf00d08dbdcff7f1224eb2">00160</a> <span class="keywordtype">void</span> <a class="code" href="group___s_t_m32_f4xx___system___private___functions.html#ga93f514700ccf00d08dbdcff7f1224eb2" title="Setup the microcontroller system Initialize the FPU setting, vector table location and External memor...">SystemInit</a>(<span class="keywordtype">void</span>)
<a name="l00161"></a>00161 {
<a name="l00162"></a>00162   <span class="comment">/* FPU settings ------------------------------------------------------------*/</span>
<a name="l00163"></a>00163 <span class="preprocessor">  #if (__FPU_PRESENT == 1) &amp;&amp; (__FPU_USED == 1)</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span>    SCB-&gt;CPACR |= ((3UL &lt;&lt; 10*2)|(3UL &lt;&lt; 11*2));  <span class="comment">/* set CP10 and CP11 Full Access */</span>
<a name="l00165"></a>00165 <span class="preprocessor">  #endif</span>
<a name="l00166"></a>00166 <span class="preprocessor"></span>  <span class="comment">/* Reset the RCC clock configuration to the default reset state ------------*/</span>
<a name="l00167"></a>00167   <span class="comment">/* Set HSION bit */</span>
<a name="l00168"></a>00168   RCC-&gt;CR |= (uint32_t)0x00000001;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   <span class="comment">/* Reset CFGR register */</span>
<a name="l00171"></a>00171   RCC-&gt;CFGR = 0x00000000;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <span class="comment">/* Reset HSEON, CSSON and PLLON bits */</span>
<a name="l00174"></a>00174   RCC-&gt;CR &amp;= (uint32_t)0xFEF6FFFF;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176   <span class="comment">/* Reset PLLCFGR register */</span>
<a name="l00177"></a>00177   RCC-&gt;PLLCFGR = 0x24003010;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179   <span class="comment">/* Reset HSEBYP bit */</span>
<a name="l00180"></a>00180   RCC-&gt;CR &amp;= (uint32_t)0xFFFBFFFF;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   <span class="comment">/* Disable all interrupts */</span>
<a name="l00183"></a>00183   RCC-&gt;CIR = 0x00000000;
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 <span class="preprocessor">#if defined (DATA_IN_ExtSRAM) || defined (DATA_IN_ExtSDRAM)</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span>  SystemInit_ExtMemCtl(); 
<a name="l00187"></a>00187 <span class="preprocessor">#endif </span><span class="comment">/* DATA_IN_ExtSRAM || DATA_IN_ExtSDRAM */</span>
<a name="l00188"></a>00188 
<a name="l00189"></a>00189   <span class="comment">/* Configure the Vector Table location add offset address ------------------*/</span>
<a name="l00190"></a>00190 <span class="preprocessor">#ifdef VECT_TAB_SRAM</span>
<a name="l00191"></a>00191 <span class="preprocessor"></span>  SCB-&gt;VTOR = SRAM_BASE | <a class="code" href="group___s_t_m32_f4xx___system___private___defines.html#ga40e1495541cbb4acbe3f1819bd87a9fe">VECT_TAB_OFFSET</a>; <span class="comment">/* Vector Table Relocation in Internal SRAM */</span>
<a name="l00192"></a>00192 <span class="preprocessor">#else</span>
<a name="l00193"></a>00193 <span class="preprocessor"></span>  SCB-&gt;VTOR = FLASH_BASE | <a class="code" href="group___s_t_m32_f4xx___system___private___defines.html#ga40e1495541cbb4acbe3f1819bd87a9fe">VECT_TAB_OFFSET</a>; <span class="comment">/* Vector Table Relocation in Internal FLASH */</span>
<a name="l00194"></a>00194 <span class="preprocessor">#endif</span>
<a name="l00195"></a>00195 <span class="preprocessor"></span>}
<a name="l00196"></a>00196 
<a name="l00233"></a><a class="code" href="group___s_t_m32_f4xx___system___private___functions.html#gae0c36a9591fe6e9c45ecb21a794f0f0f">00233</a> <span class="keywordtype">void</span> <a class="code" href="group___s_t_m32_f4xx___system___private___functions.html#gae0c36a9591fe6e9c45ecb21a794f0f0f" title="Update SystemCoreClock variable according to Clock Register Values. The SystemCoreClock variable cont...">SystemCoreClockUpdate</a>(<span class="keywordtype">void</span>)
<a name="l00234"></a>00234 {
<a name="l00235"></a>00235   uint32_t tmp = 0, pllvco = 0, pllp = 2, pllsource = 0, pllm = 2;
<a name="l00236"></a>00236   
<a name="l00237"></a>00237   <span class="comment">/* Get SYSCLK source -------------------------------------------------------*/</span>
<a name="l00238"></a>00238   tmp = RCC-&gt;CFGR &amp; RCC_CFGR_SWS;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   <span class="keywordflow">switch</span> (tmp)
<a name="l00241"></a>00241   {
<a name="l00242"></a>00242     <span class="keywordflow">case</span> 0x00:  <span class="comment">/* HSI used as system clock source */</span>
<a name="l00243"></a>00243       <a class="code" href="group___s_t_m32_f4xx___system___private___variables.html#gaa3cd3e43291e81e795d642b79b6088e6">SystemCoreClock</a> = <a class="code" href="stm32f4xx__hal__conf_8h.html#aaa8c76e274d0f6dd2cefb5d0b17fbc37" title="Internal High Speed oscillator (HSI) value. This value is used by the RCC HAL module to compute the s...">HSI_VALUE</a>;
<a name="l00244"></a>00244       <span class="keywordflow">break</span>;
<a name="l00245"></a>00245     <span class="keywordflow">case</span> 0x04:  <span class="comment">/* HSE used as system clock source */</span>
<a name="l00246"></a>00246       <a class="code" href="group___s_t_m32_f4xx___system___private___variables.html#gaa3cd3e43291e81e795d642b79b6088e6">SystemCoreClock</a> = <a class="code" href="stm32f4xx__hal__conf_8h.html#aeafcff4f57440c60e64812dddd13e7cb" title="Adjust the value of External High Speed oscillator (HSE) used in your application. This value is used by the RCC HAL module to compute the system frequency (when HSE is used as system clock source, directly or through the PLL).">HSE_VALUE</a>;
<a name="l00247"></a>00247       <span class="keywordflow">break</span>;
<a name="l00248"></a>00248     <span class="keywordflow">case</span> 0x08:  <span class="comment">/* PLL used as system clock source */</span>
<a name="l00249"></a>00249 
<a name="l00250"></a>00250       <span class="comment">/* PLL_VCO = (HSE_VALUE or HSI_VALUE / PLL_M) * PLL_N</span>
<a name="l00251"></a>00251 <span class="comment">         SYSCLK = PLL_VCO / PLL_P</span>
<a name="l00252"></a>00252 <span class="comment">         */</span>    
<a name="l00253"></a>00253       pllsource = (RCC-&gt;PLLCFGR &amp; RCC_PLLCFGR_PLLSRC) &gt;&gt; 22;
<a name="l00254"></a>00254       pllm = RCC-&gt;PLLCFGR &amp; RCC_PLLCFGR_PLLM;
<a name="l00255"></a>00255       
<a name="l00256"></a>00256       <span class="keywordflow">if</span> (pllsource != 0)
<a name="l00257"></a>00257       {
<a name="l00258"></a>00258         <span class="comment">/* HSE used as PLL clock source */</span>
<a name="l00259"></a>00259         pllvco = (<a class="code" href="stm32f4xx__hal__conf_8h.html#aeafcff4f57440c60e64812dddd13e7cb" title="Adjust the value of External High Speed oscillator (HSE) used in your application. This value is used by the RCC HAL module to compute the system frequency (when HSE is used as system clock source, directly or through the PLL).">HSE_VALUE</a> / pllm) * ((RCC-&gt;PLLCFGR &amp; RCC_PLLCFGR_PLLN) &gt;&gt; 6);
<a name="l00260"></a>00260       }
<a name="l00261"></a>00261       <span class="keywordflow">else</span>
<a name="l00262"></a>00262       {
<a name="l00263"></a>00263         <span class="comment">/* HSI used as PLL clock source */</span>
<a name="l00264"></a>00264         pllvco = (<a class="code" href="stm32f4xx__hal__conf_8h.html#aaa8c76e274d0f6dd2cefb5d0b17fbc37" title="Internal High Speed oscillator (HSI) value. This value is used by the RCC HAL module to compute the s...">HSI_VALUE</a> / pllm) * ((RCC-&gt;PLLCFGR &amp; RCC_PLLCFGR_PLLN) &gt;&gt; 6);
<a name="l00265"></a>00265       }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267       pllp = (((RCC-&gt;PLLCFGR &amp; RCC_PLLCFGR_PLLP) &gt;&gt;16) + 1 ) *2;
<a name="l00268"></a>00268       <a class="code" href="group___s_t_m32_f4xx___system___private___variables.html#gaa3cd3e43291e81e795d642b79b6088e6">SystemCoreClock</a> = pllvco/pllp;
<a name="l00269"></a>00269       <span class="keywordflow">break</span>;
<a name="l00270"></a>00270     <span class="keywordflow">default</span>:
<a name="l00271"></a>00271       <a class="code" href="group___s_t_m32_f4xx___system___private___variables.html#gaa3cd3e43291e81e795d642b79b6088e6">SystemCoreClock</a> = <a class="code" href="stm32f4xx__hal__conf_8h.html#aaa8c76e274d0f6dd2cefb5d0b17fbc37" title="Internal High Speed oscillator (HSI) value. This value is used by the RCC HAL module to compute the s...">HSI_VALUE</a>;
<a name="l00272"></a>00272       <span class="keywordflow">break</span>;
<a name="l00273"></a>00273   }
<a name="l00274"></a>00274   <span class="comment">/* Compute HCLK frequency --------------------------------------------------*/</span>
<a name="l00275"></a>00275   <span class="comment">/* Get HCLK prescaler */</span>
<a name="l00276"></a>00276   tmp = <a class="code" href="group___s_t_m32_f4xx___system___private___variables.html#gacdc3ef54c0704c90e69a8a84fb2d970d">AHBPrescTable</a>[((RCC-&gt;CFGR &amp; RCC_CFGR_HPRE) &gt;&gt; 4)];
<a name="l00277"></a>00277   <span class="comment">/* HCLK frequency */</span>
<a name="l00278"></a>00278   <a class="code" href="group___s_t_m32_f4xx___system___private___variables.html#gaa3cd3e43291e81e795d642b79b6088e6">SystemCoreClock</a> &gt;&gt;= tmp;
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 <span class="preprocessor">#if defined (DATA_IN_ExtSRAM) || defined (DATA_IN_ExtSDRAM)</span>
<a name="l00282"></a>00282 <span class="preprocessor"></span>
<a name="l00290"></a>00290 <span class="keywordtype">void</span> SystemInit_ExtMemCtl(<span class="keywordtype">void</span>)
<a name="l00291"></a>00291 {
<a name="l00292"></a>00292 <span class="preprocessor">#if defined(STM32F427xx) || defined(STM32F437xx) || defined(STM32F429xx) || defined(STM32F439xx)</span>
<a name="l00293"></a>00293 <span class="preprocessor"></span><span class="preprocessor">#if defined (DATA_IN_ExtSDRAM)</span>
<a name="l00294"></a>00294 <span class="preprocessor"></span>  <span class="keyword">register</span> uint32_t tmpreg = 0, timeout = 0xFFFF;
<a name="l00295"></a>00295   <span class="keyword">register</span> uint32_t index;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297   <span class="comment">/* Enable GPIOC, GPIOD, GPIOE, GPIOF, GPIOG, GPIOH and GPIOI interface </span>
<a name="l00298"></a>00298 <span class="comment">      clock */</span>
<a name="l00299"></a>00299   RCC-&gt;AHB1ENR |= 0x000001F8;
<a name="l00300"></a>00300   
<a name="l00301"></a>00301   <span class="comment">/* Connect PDx pins to FMC Alternate function */</span>
<a name="l00302"></a>00302   GPIOD-&gt;AFR[0]  = 0x000000CC;
<a name="l00303"></a>00303   GPIOD-&gt;AFR[1]  = 0xCC000CCC;
<a name="l00304"></a>00304   <span class="comment">/* Configure PDx pins in Alternate function mode */</span>  
<a name="l00305"></a>00305   GPIOD-&gt;MODER   = 0xA02A000A;
<a name="l00306"></a>00306   <span class="comment">/* Configure PDx pins speed to 50 MHz */</span>  
<a name="l00307"></a>00307   GPIOD-&gt;OSPEEDR = 0xA02A000A;
<a name="l00308"></a>00308   <span class="comment">/* Configure PDx pins Output type to push-pull */</span>  
<a name="l00309"></a>00309   GPIOD-&gt;OTYPER  = 0x00000000;
<a name="l00310"></a>00310   <span class="comment">/* No pull-up, pull-down for PDx pins */</span> 
<a name="l00311"></a>00311   GPIOD-&gt;PUPDR   = 0x00000000;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313   <span class="comment">/* Connect PEx pins to FMC Alternate function */</span>
<a name="l00314"></a>00314   GPIOE-&gt;AFR[0]  = 0xC00000CC;
<a name="l00315"></a>00315   GPIOE-&gt;AFR[1]  = 0xCCCCCCCC;
<a name="l00316"></a>00316   <span class="comment">/* Configure PEx pins in Alternate function mode */</span> 
<a name="l00317"></a>00317   GPIOE-&gt;MODER   = 0xAAAA800A;
<a name="l00318"></a>00318   <span class="comment">/* Configure PEx pins speed to 50 MHz */</span> 
<a name="l00319"></a>00319   GPIOE-&gt;OSPEEDR = 0xAAAA800A;
<a name="l00320"></a>00320   <span class="comment">/* Configure PEx pins Output type to push-pull */</span>  
<a name="l00321"></a>00321   GPIOE-&gt;OTYPER  = 0x00000000;
<a name="l00322"></a>00322   <span class="comment">/* No pull-up, pull-down for PEx pins */</span> 
<a name="l00323"></a>00323   GPIOE-&gt;PUPDR   = 0x00000000;
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   <span class="comment">/* Connect PFx pins to FMC Alternate function */</span>
<a name="l00326"></a>00326   GPIOF-&gt;AFR[0]  = 0xCCCCCCCC;
<a name="l00327"></a>00327   GPIOF-&gt;AFR[1]  = 0xCCCCCCCC;
<a name="l00328"></a>00328   <span class="comment">/* Configure PFx pins in Alternate function mode */</span>   
<a name="l00329"></a>00329   GPIOF-&gt;MODER   = 0xAA800AAA;
<a name="l00330"></a>00330   <span class="comment">/* Configure PFx pins speed to 50 MHz */</span> 
<a name="l00331"></a>00331   GPIOF-&gt;OSPEEDR = 0xAA800AAA;
<a name="l00332"></a>00332   <span class="comment">/* Configure PFx pins Output type to push-pull */</span>  
<a name="l00333"></a>00333   GPIOF-&gt;OTYPER  = 0x00000000;
<a name="l00334"></a>00334   <span class="comment">/* No pull-up, pull-down for PFx pins */</span> 
<a name="l00335"></a>00335   GPIOF-&gt;PUPDR   = 0x00000000;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   <span class="comment">/* Connect PGx pins to FMC Alternate function */</span>
<a name="l00338"></a>00338   GPIOG-&gt;AFR[0]  = 0xCCCCCCCC;
<a name="l00339"></a>00339   GPIOG-&gt;AFR[1]  = 0xCCCCCCCC;
<a name="l00340"></a>00340   <span class="comment">/* Configure PGx pins in Alternate function mode */</span> 
<a name="l00341"></a>00341   GPIOG-&gt;MODER   = 0xAAAAAAAA;
<a name="l00342"></a>00342   <span class="comment">/* Configure PGx pins speed to 50 MHz */</span> 
<a name="l00343"></a>00343   GPIOG-&gt;OSPEEDR = 0xAAAAAAAA;
<a name="l00344"></a>00344   <span class="comment">/* Configure PGx pins Output type to push-pull */</span>  
<a name="l00345"></a>00345   GPIOG-&gt;OTYPER  = 0x00000000;
<a name="l00346"></a>00346   <span class="comment">/* No pull-up, pull-down for PGx pins */</span> 
<a name="l00347"></a>00347   GPIOG-&gt;PUPDR   = 0x00000000;
<a name="l00348"></a>00348   
<a name="l00349"></a>00349   <span class="comment">/* Connect PHx pins to FMC Alternate function */</span>
<a name="l00350"></a>00350   GPIOH-&gt;AFR[0]  = 0x00C0CC00;
<a name="l00351"></a>00351   GPIOH-&gt;AFR[1]  = 0xCCCCCCCC;
<a name="l00352"></a>00352   <span class="comment">/* Configure PHx pins in Alternate function mode */</span> 
<a name="l00353"></a>00353   GPIOH-&gt;MODER   = 0xAAAA08A0;
<a name="l00354"></a>00354   <span class="comment">/* Configure PHx pins speed to 50 MHz */</span> 
<a name="l00355"></a>00355   GPIOH-&gt;OSPEEDR = 0xAAAA08A0;
<a name="l00356"></a>00356   <span class="comment">/* Configure PHx pins Output type to push-pull */</span>  
<a name="l00357"></a>00357   GPIOH-&gt;OTYPER  = 0x00000000;
<a name="l00358"></a>00358   <span class="comment">/* No pull-up, pull-down for PHx pins */</span> 
<a name="l00359"></a>00359   GPIOH-&gt;PUPDR   = 0x00000000;
<a name="l00360"></a>00360   
<a name="l00361"></a>00361   <span class="comment">/* Connect PIx pins to FMC Alternate function */</span>
<a name="l00362"></a>00362   GPIOI-&gt;AFR[0]  = 0xCCCCCCCC;
<a name="l00363"></a>00363   GPIOI-&gt;AFR[1]  = 0x00000CC0;
<a name="l00364"></a>00364   <span class="comment">/* Configure PIx pins in Alternate function mode */</span> 
<a name="l00365"></a>00365   GPIOI-&gt;MODER   = 0x0028AAAA;
<a name="l00366"></a>00366   <span class="comment">/* Configure PIx pins speed to 50 MHz */</span> 
<a name="l00367"></a>00367   GPIOI-&gt;OSPEEDR = 0x0028AAAA;
<a name="l00368"></a>00368   <span class="comment">/* Configure PIx pins Output type to push-pull */</span>  
<a name="l00369"></a>00369   GPIOI-&gt;OTYPER  = 0x00000000;
<a name="l00370"></a>00370   <span class="comment">/* No pull-up, pull-down for PIx pins */</span> 
<a name="l00371"></a>00371   GPIOI-&gt;PUPDR   = 0x00000000;
<a name="l00372"></a>00372   
<a name="l00373"></a>00373 <span class="comment">/*-- FMC Configuration ------------------------------------------------------*/</span>
<a name="l00374"></a>00374   <span class="comment">/* Enable the FMC interface clock */</span>
<a name="l00375"></a>00375   RCC-&gt;AHB3ENR |= 0x00000001;
<a name="l00376"></a>00376   
<a name="l00377"></a>00377   <span class="comment">/* Configure and enable SDRAM bank1 */</span>
<a name="l00378"></a>00378   FMC_Bank5_6-&gt;SDCR[0] = 0x000019E0;
<a name="l00379"></a>00379   FMC_Bank5_6-&gt;SDTR[0] = 0x01115351;      
<a name="l00380"></a>00380   
<a name="l00381"></a>00381   <span class="comment">/* SDRAM initialization sequence */</span>
<a name="l00382"></a>00382   <span class="comment">/* Clock enable command */</span>
<a name="l00383"></a>00383   FMC_Bank5_6-&gt;SDCMR = 0x00000011; 
<a name="l00384"></a>00384   tmpreg = FMC_Bank5_6-&gt;SDSR &amp; 0x00000020; 
<a name="l00385"></a>00385   <span class="keywordflow">while</span>((tmpreg != 0) &amp;&amp; (timeout-- &gt; 0))
<a name="l00386"></a>00386   {
<a name="l00387"></a>00387     tmpreg = FMC_Bank5_6-&gt;SDSR &amp; 0x00000020; 
<a name="l00388"></a>00388   }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390   <span class="comment">/* Delay */</span>
<a name="l00391"></a>00391   <span class="keywordflow">for</span> (index = 0; index&lt;1000; index++);
<a name="l00392"></a>00392   
<a name="l00393"></a>00393   <span class="comment">/* PALL command */</span>
<a name="l00394"></a>00394   FMC_Bank5_6-&gt;SDCMR = 0x00000012;           
<a name="l00395"></a>00395   timeout = 0xFFFF;
<a name="l00396"></a>00396   <span class="keywordflow">while</span>((tmpreg != 0) &amp;&amp; (timeout-- &gt; 0))
<a name="l00397"></a>00397   {
<a name="l00398"></a>00398     tmpreg = FMC_Bank5_6-&gt;SDSR &amp; 0x00000020; 
<a name="l00399"></a>00399   }
<a name="l00400"></a>00400   
<a name="l00401"></a>00401   <span class="comment">/* Auto refresh command */</span>
<a name="l00402"></a>00402   FMC_Bank5_6-&gt;SDCMR = 0x00000073;
<a name="l00403"></a>00403   timeout = 0xFFFF;
<a name="l00404"></a>00404   <span class="keywordflow">while</span>((tmpreg != 0) &amp;&amp; (timeout-- &gt; 0))
<a name="l00405"></a>00405   {
<a name="l00406"></a>00406     tmpreg = FMC_Bank5_6-&gt;SDSR &amp; 0x00000020; 
<a name="l00407"></a>00407   }
<a name="l00408"></a>00408  
<a name="l00409"></a>00409   <span class="comment">/* MRD register program */</span>
<a name="l00410"></a>00410   FMC_Bank5_6-&gt;SDCMR = 0x00046014;
<a name="l00411"></a>00411   timeout = 0xFFFF;
<a name="l00412"></a>00412   <span class="keywordflow">while</span>((tmpreg != 0) &amp;&amp; (timeout-- &gt; 0))
<a name="l00413"></a>00413   {
<a name="l00414"></a>00414     tmpreg = FMC_Bank5_6-&gt;SDSR &amp; 0x00000020; 
<a name="l00415"></a>00415   } 
<a name="l00416"></a>00416   
<a name="l00417"></a>00417   <span class="comment">/* Set refresh count */</span>
<a name="l00418"></a>00418   tmpreg = FMC_Bank5_6-&gt;SDRTR;
<a name="l00419"></a>00419   FMC_Bank5_6-&gt;SDRTR = (tmpreg | (0x0000027C&lt;&lt;1));
<a name="l00420"></a>00420   
<a name="l00421"></a>00421   <span class="comment">/* Disable write protection */</span>
<a name="l00422"></a>00422   tmpreg = FMC_Bank5_6-&gt;SDCR[0]; 
<a name="l00423"></a>00423   FMC_Bank5_6-&gt;SDCR[0] = (tmpreg &amp; 0xFFFFFDFF);
<a name="l00424"></a>00424 <span class="preprocessor">#endif </span><span class="comment">/* DATA_IN_ExtSDRAM */</span>
<a name="l00425"></a>00425 <span class="preprocessor">#endif </span><span class="comment">/* STM32F427xx || STM32F437xx || STM32F429xx || STM32F439xx */</span>
<a name="l00426"></a>00426 
<a name="l00427"></a>00427 <span class="preprocessor">#if defined(STM32F405xx) || defined(STM32F415xx) || defined(STM32F407xx) || defined(STM32F417xx) || defined(STM32F427xx) || defined(STM32F437xx) || defined(STM32F429xx) || defined(STM32F439xx)</span>
<a name="l00428"></a>00428 <span class="preprocessor"></span><span class="preprocessor">#if defined(DATA_IN_ExtSRAM)</span>
<a name="l00429"></a>00429 <span class="preprocessor"></span><span class="comment">/*-- GPIOs Configuration -----------------------------------------------------*/</span>
<a name="l00430"></a>00430    <span class="comment">/* Enable GPIOD, GPIOE, GPIOF and GPIOG interface clock */</span>
<a name="l00431"></a>00431   RCC-&gt;AHB1ENR   |= 0x00000078;
<a name="l00432"></a>00432   
<a name="l00433"></a>00433   <span class="comment">/* Connect PDx pins to FMC Alternate function */</span>
<a name="l00434"></a>00434   GPIOD-&gt;AFR[0]  = 0x00CCC0CC;
<a name="l00435"></a>00435   GPIOD-&gt;AFR[1]  = 0xCCCCCCCC;
<a name="l00436"></a>00436   <span class="comment">/* Configure PDx pins in Alternate function mode */</span>  
<a name="l00437"></a>00437   GPIOD-&gt;MODER   = 0xAAAA0A8A;
<a name="l00438"></a>00438   <span class="comment">/* Configure PDx pins speed to 100 MHz */</span>  
<a name="l00439"></a>00439   GPIOD-&gt;OSPEEDR = 0xFFFF0FCF;
<a name="l00440"></a>00440   <span class="comment">/* Configure PDx pins Output type to push-pull */</span>  
<a name="l00441"></a>00441   GPIOD-&gt;OTYPER  = 0x00000000;
<a name="l00442"></a>00442   <span class="comment">/* No pull-up, pull-down for PDx pins */</span> 
<a name="l00443"></a>00443   GPIOD-&gt;PUPDR   = 0x00000000;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445   <span class="comment">/* Connect PEx pins to FMC Alternate function */</span>
<a name="l00446"></a>00446   GPIOE-&gt;AFR[0]  = 0xC00CC0CC;
<a name="l00447"></a>00447   GPIOE-&gt;AFR[1]  = 0xCCCCCCCC;
<a name="l00448"></a>00448   <span class="comment">/* Configure PEx pins in Alternate function mode */</span> 
<a name="l00449"></a>00449   GPIOE-&gt;MODER   = 0xAAAA828A;
<a name="l00450"></a>00450   <span class="comment">/* Configure PEx pins speed to 100 MHz */</span> 
<a name="l00451"></a>00451   GPIOE-&gt;OSPEEDR = 0xFFFFC3CF;
<a name="l00452"></a>00452   <span class="comment">/* Configure PEx pins Output type to push-pull */</span>  
<a name="l00453"></a>00453   GPIOE-&gt;OTYPER  = 0x00000000;
<a name="l00454"></a>00454   <span class="comment">/* No pull-up, pull-down for PEx pins */</span> 
<a name="l00455"></a>00455   GPIOE-&gt;PUPDR   = 0x00000000;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457   <span class="comment">/* Connect PFx pins to FMC Alternate function */</span>
<a name="l00458"></a>00458   GPIOF-&gt;AFR[0]  = 0x00CCCCCC;
<a name="l00459"></a>00459   GPIOF-&gt;AFR[1]  = 0xCCCC0000;
<a name="l00460"></a>00460   <span class="comment">/* Configure PFx pins in Alternate function mode */</span>   
<a name="l00461"></a>00461   GPIOF-&gt;MODER   = 0xAA000AAA;
<a name="l00462"></a>00462   <span class="comment">/* Configure PFx pins speed to 100 MHz */</span> 
<a name="l00463"></a>00463   GPIOF-&gt;OSPEEDR = 0xFF000FFF;
<a name="l00464"></a>00464   <span class="comment">/* Configure PFx pins Output type to push-pull */</span>  
<a name="l00465"></a>00465   GPIOF-&gt;OTYPER  = 0x00000000;
<a name="l00466"></a>00466   <span class="comment">/* No pull-up, pull-down for PFx pins */</span> 
<a name="l00467"></a>00467   GPIOF-&gt;PUPDR   = 0x00000000;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469   <span class="comment">/* Connect PGx pins to FMC Alternate function */</span>
<a name="l00470"></a>00470   GPIOG-&gt;AFR[0]  = 0x00CCCCCC;
<a name="l00471"></a>00471   GPIOG-&gt;AFR[1]  = 0x000000C0;
<a name="l00472"></a>00472   <span class="comment">/* Configure PGx pins in Alternate function mode */</span> 
<a name="l00473"></a>00473   GPIOG-&gt;MODER   = 0x00085AAA;
<a name="l00474"></a>00474   <span class="comment">/* Configure PGx pins speed to 100 MHz */</span> 
<a name="l00475"></a>00475   GPIOG-&gt;OSPEEDR = 0x000CAFFF;
<a name="l00476"></a>00476   <span class="comment">/* Configure PGx pins Output type to push-pull */</span>  
<a name="l00477"></a>00477   GPIOG-&gt;OTYPER  = 0x00000000;
<a name="l00478"></a>00478   <span class="comment">/* No pull-up, pull-down for PGx pins */</span> 
<a name="l00479"></a>00479   GPIOG-&gt;PUPDR   = 0x00000000;
<a name="l00480"></a>00480   
<a name="l00481"></a>00481 <span class="comment">/*-- FMC/FSMC Configuration --------------------------------------------------*/</span>                                                                               
<a name="l00482"></a>00482   <span class="comment">/* Enable the FMC/FSMC interface clock */</span>
<a name="l00483"></a>00483   RCC-&gt;AHB3ENR         |= 0x00000001;
<a name="l00484"></a>00484   
<a name="l00485"></a>00485 <span class="preprocessor">#if defined(STM32F427xx) || defined(STM32F437xx) || defined(STM32F429xx)|| defined(STM32F439xx) </span>
<a name="l00486"></a>00486 <span class="preprocessor"></span>  <span class="comment">/* Configure and enable Bank1_SRAM2 */</span>
<a name="l00487"></a>00487   FMC_Bank1-&gt;BTCR[2]  = 0x00001011;
<a name="l00488"></a>00488   FMC_Bank1-&gt;BTCR[3]  = 0x00000201;
<a name="l00489"></a>00489   FMC_Bank1E-&gt;BWTR[2] = 0x0fffffff;
<a name="l00490"></a>00490 <span class="preprocessor">#endif </span><span class="comment">/* STM32F427xx || STM32F437xx || STM32F429xx || STM32F439xx */</span> 
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 <span class="preprocessor">#if defined(STM32F405xx) || defined(STM32F415xx) || defined(STM32F407xx)|| defined(STM32F417xx)</span>
<a name="l00493"></a>00493 <span class="preprocessor"></span>  <span class="comment">/* Configure and enable Bank1_SRAM2 */</span>
<a name="l00494"></a>00494   FSMC_Bank1-&gt;BTCR[2]  = 0x00001011;
<a name="l00495"></a>00495   FSMC_Bank1-&gt;BTCR[3]  = 0x00000201;
<a name="l00496"></a>00496   FSMC_Bank1E-&gt;BWTR[2] = 0x0FFFFFFF;
<a name="l00497"></a>00497 <span class="preprocessor">#endif </span><span class="comment">/* STM32F405xx || STM32F415xx || STM32F407xx || STM32F417xx */</span>
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 <span class="preprocessor">#endif </span><span class="comment">/* DATA_IN_ExtSRAM */</span>
<a name="l00500"></a>00500 <span class="preprocessor">#endif </span><span class="comment">/* STM32F405xx || STM32F415xx || STM32F407xx || STM32F417xx || STM32F427xx || STM32F437xx || STM32F429xx || STM32F439xx */</span> 
<a name="l00501"></a>00501 }
<a name="l00502"></a>00502 <span class="preprocessor">#endif </span><span class="comment">/* DATA_IN_ExtSRAM || DATA_IN_ExtSDRAM */</span>
<a name="l00503"></a>00503 
<a name="l00514"></a>00514 <span class="comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span>
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>Указатель</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Структуры данных</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Файлы</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Функции</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Переменные</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Перечисления</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Элементы перечислений</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Макросы</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Документация по КСУ-02. Последние изменения: Пн 2 Мар 2015 15:35:47. Создано системой &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
